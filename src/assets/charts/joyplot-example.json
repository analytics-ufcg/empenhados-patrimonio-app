{
    "$schema": "https://vega.github.io/schema/vega/v4.json",
    "width": 500,
    "height": 380,
    "padding": 5,
    "autosize": "fit",
    "config": {
        "text": {
            "font": "Ideal Sans, Avenir Next, Helvetica"
        },
        "title": {
            "font": "Ideal Sans, Avenir Next, Helvetica",
            "fontWeight": 500,
            "fontSize": 17,
            "limit": -1
        },
        "axis": {
            "labelFont": "Ideal Sans, Avenir Next, Helvetica",
            "labelFontSize": 12
        }
    },
    "signals": [
        {
            "name": "size",
            "value": 2
        },
        {
            "name": "domainMax",
            "value": 500
        },
        {
            "name": "bandwidth",
            "value": 0.0005
        },
        {
            "name": "categories",
            "value": [
                "AC",
                "AL",
                "AM",
                "AP",
                "BA",
                "BR",
                "CE",
                "DF",
                "ES",
                "GO",
                "MA",
                "MG",
                "MS",
                "MT",
                "PA",
                "PB",
                "PE",
                "PI",
                "PR",
                "RJ",
                "RN",
                "RO",
                "RR",
                "RS",
                "SC",
                "SE",
                "SP",
                "TO"
            ]
        },
        {
            "name": "names",
            "value": [
                "AC",
                "AL",
                "AM",
                "AP",
                "BA",
                "BR",
                "CE",
                "DF",
                "ES",
                "GO",
                "MA",
                "MG",
                "MS",
                "MT",
                "PA",
                "PB",
                "PE",
                "PI",
                "PR",
                "RJ",
                "RN",
                "RO",
                "RR",
                "RS",
                "SC",
                "SE",
                "SP",
                "TO"
            ]
        },
        {
            "name": "colors",
            "value": [
                "#7f7f7f",
                "#7f7f7f",
                "#7f7f7f",
                "#1f77b4",
                "#1f77b4",
                "#1f77b4",
                "#1f77b4",
                "#1f77b4",
                "#2ca02c",
                "#2ca02c",
                "#ff7f0e",
                "#ff7f0e",
                "#ff7f0e",
                "#8c564b",
                "#8c564b",
                "#e377c2",
                "#e377c2",
                "#bcbd22",
                "#17becf"
            ]
        }
    ],
    "data": [
        {
            "name": "source",
            "url": "assets/data/dados-temp.json",
            "transform": [
                {
                    "type": "filter",
                    "expr": "datum.ganho_relativo != 0"
                }
            ]
        },
        {
            "name": "annotation",
            "values": [
                {
                    "name": "-100x",
                    "align": "left",
                    "ganho_relativo": 0.01
                },
                {
                    "name": "-10x",
                    "align": "center",
                    "ganho_relativo": 0.1
                },
                {
                    "name": "-2x",
                    "align": "center",
                    "ganho_relativo": 0.5
                },
                {
                    "name": "1x",
                    "align": "center",
                    "ganho_relativo": 1
                },
                {
                    "name": "2x",
                    "align": "center",
                    "ganho_relativo": 2
                },
                {
                    "name": "10x",
                    "align": "center",
                    "ganho_relativo": 10
                },
                {
                    "name": "100x",
                    "align": "center",
                    "ganho_relativo": 100
                }
            ]
        }
    ],
    "scales": [
        {
            "name": "xscale",
            "type": "log",
            "range": "width",
            "zero": false,
            "nice": true,
            "domain": {
                "data": "source",
                "field": "ganho_relativo"
            }
        },
        {
            "name": "yscale",
            "type": "band",
            "range": "height",
            "round": true,
            "padding": 0,
            "domain": {
                "signal": "categories"
            }
        },
        {
            "name": "color",
            "type": "ordinal",
            "range": {
                "signal": "colors"
            },
            "domain": {
                "signal": "categories"
            }
        },
        {
            "name": "names",
            "type": "ordinal",
            "domain": {
                "signal": "categories"
            },
            "range": {
                "signal": "names"
            }
        }
    ],
    "axes": [
        {
            "orient": "right",
            "scale": "yscale",
            "domain": false,
            "ticks": false,
            "encode": {
                "labels": {
                    "update": {
                        "dx": {
                            "value": 2
                        },
                        "dy": {
                            "value": 2
                        },
                        "y": {
                            "scale": "yscale",
                            "field": "value",
                            "band": 1
                        },
                        "text": {
                            "scale": "names",
                            "field": "value"
                        },
                        "baseline": {
                            "value": "bottom"
                        }
                    }
                }
            }
        }
    ],
    "marks": [
        {
            "type": "rule",
            "from": {
                "data": "annotation"
            },
            "encode": {
                "update": {
                    "x": {
                        "signal": "round(scale('xscale', datum.ganho_relativo)) + 0.5"
                    },
                    "y": {
                        "value": 20
                    },
                    "x2": {
                        "signal": "round(scale('xscale', datum.ganho_relativo)) + 0.5"
                    },
                    "y2": {
                        "signal": "height",
                        "offset": 6
                    },
                    "stroke": {
                        "value": "#ddd"
                    },
                    "strokeDash": {
                        "value": [
                            3,
                            2
                        ]
                    }
                }
            }
        },
        {
            "type": "text",
            "from": {
                "data": "annotation"
            },
            "encode": {
                "update": {
                    "x": {
                        "scale": "xscale",
                        "field": "ganho_relativo",
                        "offset": 0
                    },
                    "dx": {
                        "signal": "datum.align === 'left' ? -1 : 0"
                    },
                    "y": {
                        "signal": "height",
                        "offset": 6
                    },
                    "align": {
                        "field": "align"
                    },
                    "baseline": {
                        "value": "top"
                    },
                    "text": {
                        "field": "name"
                    },
                    "fontStyle": {
                        "value": "italic"
                    }
                }
            }
        },
        {
            "type": "group",
            "from": {
                "facet": {
                    "data": "source",
                    "name": "category",
                    "groupby": "estado",
                    "aggregate": {
                        "ops": [
                            "min",
                            "max",
                            "count"
                        ],
                        "fields": [
                            "ganho_relativo",
                            "ganho_relativo",
                            "ganho_relativo"
                        ],
                        "as": [
                            "min_ganho",
                            "max_ganho",
                            "count"
                        ]
                    }
                }
            },
            "encode": {
                "update": {
                    "y": {
                        "scale": "yscale",
                        "field": "estado"
                    },
                    "width": {
                        "signal": "width"
                    },
                    "height": {
                        "scale": "yscale",
                        "band": 1
                    }
                }
            },
            "sort": {
                "field": "y",
                "order": "ascending"
            },
            "signals": [
                {
                    "name": "height",
                    "update": "bandwidth('yscale')"
                }
            ],
            "data": [
                {
                    "name": "density",
                    "source": "category",
                    "transform": [
                        {
                            "type": "density",
                            "steps": 200,
                            "extent": {
                                "signal": "domain('xscale')"
                            },
                            "distribution": {
                                "function": "kde",
                                "field": "ganho_relativo",
                                "bandwidth": {
                                    "signal": "bandwidth"
                                }
                            }
                        }
                    ]
                }
            ],
            "scales": [
                {
                    "name": "yinner",
                    "type": "linear",
                    "range": [
                        {
                            "signal": "height"
                        },
                        {
                            "signal": "0 - size * height"
                        }
                    ],
                    "domain": [
                        0,
                        {
                            "signal": "domainMax"
                        }
                    ]
                }
            ],
            "marks": [
                {
                    "type": "area",
                    "from": {
                        "data": "density"
                    },
                    "encode": {
                        "enter": {
                            "fill": {
                                "scale": "color",
                                "field": {
                                    "parent": "estado"
                                }
                            },
                            "fillOpacity": {
                                "value": 0.7
                            },
                            "stroke": {
                                "value": "white"
                            },
                            "strokeWidth": {
                                "value": 1
                            }
                        },
                        "update": {
                            "x": {
                                "scale": "xscale",
                                "field": "value"
                            },
                            "y": {
                                "scale": "yinner",
                                "signal": "parent.count * datum.density"
                            },
                            "y2": {
                                "scale": "yinner",
                                "value": 0
                            }
                        }
                    }
                },
                {
                    "type": "rule",
                    "clip": true,
                    "encode": {
                        "update": {
                            "y": {
                                "signal": "height",
                                "offset": -0.5
                            },
                            "x": {
                                "scale": "xscale",
                                "field": {
                                    "parent": "min_ganho"
                                },
                                "offset": {
                                    "signal": "scale('xscale', 0) - scale('xscale', 2*bandwidth) - 3"
                                }
                            },
                            "x2": {
                                "signal": "width"
                            },
                            "stroke": {
                                "value": "#aaa"
                            },
                            "strokeWidth": {
                                "value": 0.25
                            },
                            "strokeOpacity": {
                                "value": 1
                            }
                        }
                    }
                },
                {
                    "type": "symbol",
                    "from": {
                        "data": "category"
                    },
                    "encode": {
                        "enter": {
                            "fillOpacity": {
                                "value": 0
                            },
                            "size": {
                                "value": 50
                            },
                            "tooltip": {
                                "field": "name"
                            }
                        },
                        "update": {
                            "x": {
                                "scale": "xscale",
                                "field": "ganho_relativo"
                            },
                            "y": {
                                "scale": "yscale",
                                "band": 0.5
                            },
                            "fill": {
                                "scale": "color",
                                "field": "estado"
                            }
                        }
                    }
                }
            ]
        }
    ]
}